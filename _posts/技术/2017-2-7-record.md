---
layout: post
title: 使用记录
category: 技术
tags: 搭建环境
keywords: ubuntu
description:
---

# 服务器免密码登陆

首先本地和服务器端安装ssh
ssh-keygen在本地./ssh生成私钥和公钥
ssh-copy-id -i name.pub usr@ip将本地公钥拷贝到服务器端的.ssh里生成authorized_keys
至此实现了本地连服务器的免密码登陆

# ubuntu 截图 ctrl+alt+a

打开系统设置/键盘/Shortcuts/ 添加“截图” command gnome-screenshot -a 然后选中截图 按下ctrl+alt+a

# 清理ubuntu中孤立无用的软件包

安装Deborphan
sudo apt-get install deborphan
运行
deborphan
列出无用可删除的软件包
sudo orphaner

# ubuntu设代理

在bashrc或者profile中添加

```
export http_proxy="http://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/"
export https_proxy="https://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/"
export HTTP_PROXY="http://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/"
export HTTPS_PROXY="https://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/"
```

/etc/apt/apt.conf添加

```
Acquire::http::proxy "http://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/";
Acquire::https::proxy "https://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/";
Acquire::ftp::proxy "ftp://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/";
Acquire::socks::proxy "socks://z00b04142:z0xx6y2rn@proxy.ricoh.co.jp:8080/";
```

# ubuntu下cuda7.5升级为cuda8
由于原来版本显卡驱动不支持cuda8需要先卸载原有显卡驱动

关闭桌面显示
sudo service lightdm stop
卸载显卡驱动
sudo apt-get remove --purge nvidia-*
安装cuda8包括里面的显卡驱动
开启桌面显示
sudo service lightdm start

# ubuntu远程拷贝文件和文件夹示例

```
scp myusername@university_computer:/home/myusername/file.odt homeusername@Felix:Desktop/file.odt
sudo scp -r /home/dlg/ssd_caffe bsl@172.25.85.12:/home/bsl
```

# 防止远程Linux主机自动断开SSH连接

我在使用ssh连接远程Linux主机时，如果长时间不操作，ssh会自动断开，只能重新登陆。

原因是：由于ssh的安全机制，如果10分钟没有任何操作，本次SSH会话会自动关闭。 

怎么防止远程Linux自动断开SSH连接

下面的操作是在本地ssh客户端上，不是远程主机。

编辑SSH配置文件：

```
vim ~/.ssh/config    # 当前登陆用户生效
```

添加：

```
Host *
 ServerAliveInterval 30
```

*号代表所有主机，你可以指定某个主机，如：

```
Host server1
 ServerAliveInterval 30
```

ServerAliveInterval 30表示ssh客户端每隔30秒给远程主机发送一个no-op包，no-op是无任何操作的意思，这样远程主机就不会关闭这个SSH会话。

为了使所有用户生效，你可以在/etc/ssh/ssh_config全局配置文件添加如下一行：

```	
ServerAliveInterval 30
```

还可以在连接时使用选项：

```
ssh -o ServerAliveInterval=30 user@remote-ssh-server-ip
```

# 出现的新笔记本安装ubuntu后无法搜索到wifi问题

很可能是网卡驱动的问题，首先查看网卡型号，然后确定内核是否支持当前无线网卡。然后安装对应的驱动。

# jupyter notebook如何使用

首先把ipython升级到版本4.0以后，切换到存储了ipynb的目录下，运行jupyter notebook就会在浏览器窗口列出ipynb文件和内容

# ubuntu下 vi输入方向键会变成ABCD

ubuntu下 vi输入方向键会变成ABCD，这是ubuntu预装的是vim tiny版本，安装vim full版本即可解决。

先卸载vim-tiny：

```
sudo apt-get remove vim-common
```

再安装vim full：

```
sudo apt-get install vim
```

# ubuntu操作系统"Failed to fetch"错误

```
W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/precise-updates/main/binary-i386/Packages  Something wicked happened resolving 'archive.ubuntu.com:http' (-5 - No address associated with hostname)
  
W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/precise-updates/restricted/binary-i386/Packages  Something wicked happened resolving 'archive.ubuntu.com:http' (-5 - No address associated with hostname)
```
解决这个问题十分简单，只要设置妥当DNS服务

sudo vi /etc/resolv.conf

比如

```
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
domain abc.com
search abc.com
nameserver 10.96.1.18
nameserver 10.96.1.19
```

为了防止每次重启都需要添加，可以修改 resolvconf服务的配置文件: /etc/resolvconf/resolv.conf.d/base ，这样在机器重启或 resolvconf 服务重启 都可以保证配置会写到/etc/resolv.conf 里面 

# 安装NVIDIA显卡后无法进入tty模式

编辑/etc/default/grub

修改GRUB_CMDLINE_LINUX_DEFAULT的值为nomodeset

更新grub：sudo update-grub

重启

# Ubuntu永久挂载硬盘分区

先查看所有硬盘

```
fdisk -l |grep '/dev'
```

然后挂载一个

```
sudo mount /dev/sdb  /data
```

但这种方法有个不好的地方是机器重启后又得手工重新挂载.

首先我们得到/dev/sdb这个分区的UUID,使用以下命令:

```
sudo blkid /dev/sdb
```

然后,我们按照/etc/fstab文件中的格式添加一行如下内容:

UUID=904C23B64C23964E /data ntfs defaults        0      2

其中第一列为UUID, 第二列为挂载目录（该目录必须为空目录），第三列为文件系统类型，第四列为参数，第五列0表示不备份，最后一列必须为２或0(除非引导分区为1)

# matplotlib后台设置画图出错

backend: agg in ~/.config/matplotlib'/matplotlibrc

'/etc/matplotlibrc' Then modify the backend in that file to backend : Agg. 

# ubuntu关闭端口

```
sudo lsof -i:6006
kill PID
```

# ubuntu查看文件夹大小

```
du -sh * | sort -nr | head 
```

# ubuntu 查看当前文件夹内的文件数

```
ls | wc -l
```

# 多GPU下设定程序可见设备

在终端执行前添加下面语句

```
CUDA_VISIBLE_DEVICES=0
```

或者在代码中添加如下语句

```
import os
os.environ["CUDA_DEVICE_ORDER"]="PCI_BUS_ID"
os.environ["CUDA_VISIBLE_DEVICES"]="0"
```

# linux下快速删除大量的文件

先安装rsync 

```
yum install rsync
```

新建一个空文件夹bk，清空target文件夹

```
rsync --delete-before -d bk/ target/
```

# linux安装HDF5, boost

```
#CentOS
yum -y install hdf5-devel

yum install boost boost-devel

#Ubuntu
sudo apt-get install libhdf5-dev

sudo apt-get install libboost-all-dev
```

# Linux下释放gpu显存

tensorflow有时候会由于某种原因，在关闭程序后，GPU的显存仍处于被占用的状态，而用nvidia-smi查不到对应的进程pid。这时释放显存的方法：

```
sudo fuser /dev/nvidia*
```

该命令会显示所有占用nvidia设备的进程pid，将这些pid逐个kill掉：

```
kill -9 pid
```

发现显存已经被释放。不过，造成这种显存不能被释放现象的原因尚不清楚。

# vim全文查找替换确认

```
:1,$s/str1/str2/gc

```